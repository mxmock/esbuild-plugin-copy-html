var m=require("path"),F=require("node:fs/promises"),v=require("html-minifier").minify,{writeFile:P,readFile:R,mkdir:w,readdir:A,stat:x}=F,y=process.cwd(),H=async({htmlFrom:t,jsFrom:s,cssFrom:r,outDir:e})=>{try{if(!t)throw new Error("Must indicate where html come from");await w(e,{recursive:!0});let o=`${y}/${e}`,n=await p(t),c=await S(n,t,o),l=s?await p(s):[],i=r?await p(r):[];for(let u=0;u<c.length;u++){let{path:a,content:d}=c[u];i.length&&(d=j(i,a,d)),l.length&&(d=k(l,a,d)),await L(a,d),console.log(`Html file copied at path ${a}`)}}catch(o){console.error(`copyHtmlPlugin error - onEnd - ${o.message}`)}},p=async t=>{let s=await A(t,{withFileTypes:!0}),r=await Promise.all(s.map(e=>{let o=m.resolve(t,e.name);return e.isDirectory()?p(o):o}));return Array.prototype.concat(...r)},S=async(t,s,r)=>{let e=t.map(n=>new Promise((c,l)=>{R(n,"utf8").then(i=>{i||l(`Can't read file ${n}`);let u=b(n,s,r),a=v(i,{caseSensitive:!0,collapseWhitespace:!0,conservativeCollapse:!0});c({path:u,content:a})}).catch(i=>l(i))}));return await Promise.all(e)},b=(t,s,r)=>{let e=`${y}/${s}`.split("/"),n=t.split("/").filter(c=>!e.includes(c)).join("/");return`${r}/${n}`},j=(t,s,r)=>{let e=r;return e=$(e,'<link rel="stylesheet"','css">'),t.map(n=>D(n,s)).map(I).forEach(n=>{e=E(e,n)}),e},k=(t,s,r)=>{let e=r;return e=$(e,"<script","</script>"),t.map(n=>D(n,s)).map(q).forEach(n=>{e=E(e,n)}),e},$=(t,s,r)=>{let e=t;for(;e.includes(s);){let o=f(e,s),n=f(e,r);e=C(e,o[0],n[0],r.length)}return e},f=(t,s)=>[...t.matchAll(new RegExp(s,"gi"))].map(r=>r.index),C=(t,s,r,e)=>{let o=t.substring(0,s),n=t.substring(r+e);return`${o}${n}`},D=(t,s)=>{let r=g(s,t),e=N(r.length),o=g(t,s);return[e,...o].join("/")},g=(t,s)=>{let r=t.split("/"),e=s.split("/");return r.reduce((o,n,c)=>e[c]===n?[...o]:[...o,n],[])},N=t=>{let s=t-1;if(s===0)return".";let r="";for(let e=0;e<s;e++)r+="../";return r.slice(0,-1)},q=t=>`<script src="${t}"></script>`,I=t=>`<link rel="stylesheet" href="${t}">`,E=(t,s)=>{let r=t.indexOf("</head>"),e=t.substring(0,r),o=t.substring(r);return`${e}${s}${o}`},L=async(t,s)=>{let r=m.dirname(t);await O(r)||await w(r,{recursive:!0}),await P(t,s)},O=async t=>{let s=await x(t).catch(r=>{if(M(r))return!1;throw r});return s&&s.isDirectory()},M=t=>t.code==="ENOENT",h=t=>typeof t=="string"&&t.length>0;module.exports=(t={})=>{let s=h(t.htmlFromDir)?t.htmlFromDir:null,r=h(t.jsFromDir)?t.jsFromDir:null,e=h(t.cssFromDir)?t.cssFromDir:null,o=t.outDir||"out";return{name:"copyHtmlPlugin",setup:n=>{n.onEnd(async c=>{await H({htmlFrom:s,jsFrom:r,cssFrom:e,outDir:o})})}}};